#
# This example build is valid for the combination of gcc and OpenFusion TAO v1.4.1 only
#

# Include paths
INCLUDES=-I./
INCLUDES=$INCLUDES\ -I..
INCLUDES=$INCLUDES\ -I$OSPL_HOME/include/dcps/C++/CCPP
INCLUDES=$INCLUDES\ -I$OSPL_HOME/include/dcps/C++/CCPP/DDS_OpenFusion_1_4_1
INCLUDES=$INCLUDES\ -I$TAO_ROOT/include

# Compiler settings.
CXX=g++
CXXFLAGS="-g -c"
CPPFLAGS=-DDDS_OpenFusion_1_4_1\ $INCLUDES

# Linker settings.
LD_SO=$CXX
LD_FLAGS=
LD_LIBS=-lstdc++

# IDL Compiler settings.
IDLC=tao_idl
IDLFLAGS="-Sc -Sp -Sd -Sv"

TAO_COMP=`which tao_idl 2> /dev/null`
if [ -z "$TAO_COMP" -o -z "$TAO_ROOT" ]
then
    echo "Setup the TAO environment first"
    exit
fi

CXX_COMP=`which $CXX 2> /dev/null`
if [ -z "$CXX_COMP" ]
then
    echo "Setup the C++ environment first"
    exit
fi

SPLICE_COMP=`which idlpp 2> /dev/null`
if [ -z "$SPLICE_COMP" ]
then
    echo "Setup the SPLICE environment first"
    exit
fi

mkdir -p bld
mkdir -p exec
cd bld

echo "Compiling IDL with TAO IDL compiler"
$IDLC $INCLUDES $IDLFLAGS ../pingpong.idl

echo "Compiling IDL with SPLICE IDL compiler"
idlpp -C -l cpp ../pingpong.idl

echo "Compiling IDL Typed Interfaces with TAO IDL compiler"
$IDLC $INCLUDES $IDLFLAGS pingpongDcps.idl

echo "Compiling TAO User Types support code"
$CXX $CPPFLAGS $CXXFLAGS pingpongC.cpp

echo "Compiling SPLICE User Types support code"
$CXX $CPPFLAGS $CXXFLAGS pingpongSplDcps.cpp

echo "Compiling TAO Typed Interfaces support code"
$CXX $CPPFLAGS $CXXFLAGS pingpongDcpsC.cpp

echo "Compiling Application Foo Types support code"
$CXX $CPPFLAGS $CXXFLAGS pingpongDcps_impl.cpp

echo "Compiling PING"
$CXX $CPPFLAGS $CXXFLAGS ../ping.cpp

echo "Compiling PONG"
$CXX $CPPFLAGS $CXXFLAGS ../pong.cpp

echo "Linking PING"
$LD_SO $LD_FLAGS -o ../exec/ping $LD_LIBS -L$OSPL_HOME/lib ping.o pingpongC.o pingpongDcpsC.o pingpongDcps_impl.o pingpongSplDcps.o -L$TAO_ROOT/lib -lTAO -lACE -lTAO_PortableServer -lddsdatabase -ldcpsgapi -ldcpsccpp

echo "Linking PONG"
$LD_SO $LD_FLAGS -o ../exec/pong $LD_LIBS -L$OSPL_HOME/lib pong.o pingpongC.o pingpongDcpsC.o pingpongDcps_impl.o pingpongSplDcps.o -L$TAO_ROOT/lib -lTAO -lACE -lTAO_PortableServer -lddsdatabase -ldcpsgapi -ldcpsccpp

cd ..
