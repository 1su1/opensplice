#!/bin/sh

. buildsys/functions

ProcessArgs $*
Assert LoadConfigs
Assert SetupLogDir
Assert SetupResFile

if [ "$RUN_RBT" != "yes" ]
then
   echo "BUILD/RBT=SKIPPED" >> $RESFILE
   exit 0
fi

cd ../../..

SetState Testing
ArchiveLogs

if [ "$DEP" != "none" ]
then
   OSPL_HOME=$DEPWORKDIR
   export OSPL_HOME
fi

SPLICE_PLATFORM=$SETUP_TYPE
export SPLICE_PLATFORM
. ./configure

echo "BUILD/RBT=RUNNING" >> $RESFILE
ArchiveLogs

if [ ! -n "$OSPL_HOME" ]
then
   Fail  "ERROR: configuration - dcps_build_rbt_tests"
   SetState Failed
   exit 1
fi

cd testsuite ||
{ 
    echo "ERROR: could not cd to testsuite dir - dcps_build_rbt_tests"; 
    echo "BUILD/RBT=FAIL" >> $RESFILE ; 
    exit 1; 
}
make
if [ $? != 0 ] 
then
    echo "ERROR: building testsuite - dcps_build_rbt_tests"; 
    echo "BUILD/RBT=FAIL" >> $RESFILE
    exit 1
fi
 
cd rbt ||
{ 
    echo "ERROR: could not cd to rbt dir - dcps_build_rbt_tests"; 
    echo "BUILD/RBT=FAIL" >> $RESFILE ; 
    exit 1; 
}
make 
if [ $? = 0 ] 
then
    echo "BUILD/RBT=PASS" >> $RESFILE
else
    echo "BUILD/RBT=FAIL" >> $RESFILE
    exit 1
fi
exit 0
