#!/bin/sh

. buildsys/functions

ProcessArgs $*
Assert LoadConfigs
Assert SetupLogDir
Assert SetupResFile

if [ "$RUN_DBT" != "yes" ]
then
   echo "RUN/DBT=SKIPPED" >> $RESFILE
   exit 0
fi

cd ../../..

SetState Testing
ArchiveLogs

if [ "$DEP" != "none" ]
then
   OSPL_HOME=$DEPWORKDIR
   export OSPL_HOME
fi

SPLICE_PLATFORM=$SETUP_TYPE
export SPLICE_PLATFORM
. ./configure

echo "RUN/DBT=RUNNING" >> $RESFILE
ArchiveLogs

if [ ! -n "$OSPL_HOME" ]
then
   Fail  "ERROR: configuration - dcps_perform_dbt_tests"
   SetState Failed
   exit 1
fi

/bin/bash $OSPL_OUTER_HOME/bin/management_dbt_run run collect dev
echo "RUN/DBT=Complete" >> $RESFILE

cp -rp $OSPL_OUTER_HOME/Results $LOGDIR/DBT-Results

exit 0
