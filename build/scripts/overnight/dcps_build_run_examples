#!/bin/sh

. buildsys/functions

ProcessArgs $*
Assert LoadConfigs
Assert SetupLogDir
Assert SetupResFile

cd ../../..

SetState TestingExamples
ArchiveLogs
if [ "$DEP" != "none" ]
then
   OSPL_HOME=$DEPWORKDIR
   export OSPL_HOME
fi

SPLICE_PLATFORM=$SETUP_TYPE
export SPLICE_PLATFORM
. ./configure

if [ "$CONFIGURATION" != "OK" ]
then
   echo  "ERROR: configuration - dcps_build_rbt_tests"
   exit 1
fi

echo "RUN/EXAMPLES=RUNNING" >> $RESFILE
ArchiveLogs
mkdir $LOGDIR/examples
cd $LOGDIR/examples
mkpts > PTSNAME &
PTSN=`cat PTSNAME`
$OSPL_OUTER_HOME/testsuite/bin/run_examples_pcx86_integrity509 > run_examples.txt < $PTSN
$OSPL_OUTER_HOME/testsuite/bin/analyse_examples_pcx86_integrity509 > summary.txt

grep -v PASS summary.txt
if [ $? = 0 ]
then
   exit 1
else
   exit 0
fi
